---
title: 视差贴图(Parallax Map)
date: 2020-09-21 15:47:29
tags:
---
# 概述
* 凹凸贴图通过阴影提供了表面的凹凸感, 但是无法处理遮挡关系
* 视差贴图(也叫作高度贴图), 通过改变纹理的UV来提供遮挡的效果
* 如下图, 分别是无效果, 使用了凹凸贴图, 使用凹凸贴图和视差贴图的效果
  
[视差贴图的效果](/parallax/StandardShaderParallaxMap.jpg)

# 基本原理
1. UV与切线空间
   * 变化发生在切线空间
   * 切线空间的3个坐标轴对应TBN: 切线, 副法线和法线
   * X轴, 也就是切线, 对应UV的U
   * Y轴, 也就是副法线, 对应UV的V
2. 一个最简单的情况
   * 一个平面, 需要整体上升高度h
   * 那么平面上的一个点A, 在视角View下看到的内容应该是点B的内容, 如下图
   
   [图示](/parallax/01.png)

   * 此时只需要将U沿X方向移动(Vx / Vy) · h
   * h一般由一张高度贴图提供, 0~1的值要先映射为-0.5~0.5, 代表凹凸的程度
   * 另外使用一个缩放值来控制高度
3. 偏移量限制(Offset Limit)
   * 视角接近平行于表面时, 此时Vz将趋于0, (Vx / Vy)将趋于无穷大
   * 可以对公式进行修改来避免这个问题: (Vx / Vy) / (Vz + bias)
   * Unity将这个bias设为0.42

# 陡峭视差映射(Steep Parallax Mapping)
上面简单的例子中由于是整体上升, 所以各处的高度h都是一样的, 但实际情况并不是这样. 真正需要带入公式计算的h应该是B点的高度H(B), 而不是A点的高度H(A). 如果只是缓慢变化的斜坡或者起伏不定的平面, 这个误差还能接受. 但如果在峭壁上, 这个误差就非常得大了.

* 多次采样来逼近H(B)